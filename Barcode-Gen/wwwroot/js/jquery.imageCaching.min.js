!function(e){function t(t){var a={selector:"img",debugMode:!1,cachingKeyAttribute:"data-caching-key",sourceKeyAttribute:"data-src",renderCallback:null,crossOrigin:"Anonymous",init:function(t){a.log("Initialization of ImageCaching");for(var n in t)a[n]=t[n];e(a.selector).each(function(){a.applyToImage(e(this))})},getCacheKey:function(e){return e.attr(e.attr(a.cachingKeyAttribute)?a.cachingKeyAttribute:a.sourceKeyAttribute)},getCache:function(e){var t=this.getCacheKey(e);return localStorage.getItem(t)},setCache:function(e,t){var n=a.getCacheKey(e);return a.log("Set cache",n,t,e),localStorage.setItem(n,t),!0},removeCache:function(e){var t=a.getCacheKey(e);return a.log("Remove cache",t),localStorage.removeItem(t),!0},renderImage:function(e,t){a.log("Rendering...",t,e),e.attr("src",t),this.renderCallback&&(a.log("Render Callback...",e),this.renderCallback(t,e))},applyToImage:function(e,t){var n=null;if(t||(n=this.getCache(e)),n)a.log("Image from cache",e),this.renderImage(e,n);else{var r=e.attr(a.sourceKeyAttribute),o="?";r.indexOf("?")>0&&(o="&"),r+=o+"cacheTime="+Date.now(),a.log("Request to: "+r,e);var c=new Image;a.crossOrigin&&c.setAttribute("crossOrigin","Anonymous"),c.onload=function(){a.log("Loading completed",c);var t=document.createElement("canvas");t.width=c.width,t.height=c.height;var n=t.getContext("2d");n.drawImage(c,0,0),document.body.appendChild(t);var r=t.getContext("2d");r.drawImage(c,0,0);var o=t.toDataURL("image/png");a.setCache(e,o),a.renderImage(e,o)},c.src=r}},refresh:function(t){var n=null;n=t?t:a.selector,e(n).each(function(){a.applyToImage(e(this),!0)})},log:function(){this.debugMode&&console.log(arguments)}};return a.init(t),a}e.fn.extend({imageCaching:function(a){var n={selector:this};return n=e.extend(n,a),new t(n)}})}(jQuery);